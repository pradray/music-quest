import{b as S,c as C,F as P,S as H,d as L,V as N,B as U,j as $}from"./vendor-CyCvzkth.js";const z=({clef:M,notes:g,highlightedNoteIndex:_,noteStatuses:u})=>{const n=S.useRef();S.useRef(-1),S.useRef(0);const F=S.useRef(-1);return S.useEffect(()=>{if(n.current&&g&&g.length>0){n.current.innerHTML="";const V={w:4,h:2,q:1,8:.5},j=4,m=[];let x=[],b=0;g.forEach((t,f)=>{const a=t.duration||"w",c=V[a]||0;x.push({...t,originalIndex:f}),b+=c,b>=j&&(m.push(x),x=[],b=0)}),x.length>0&&m.push(x);const w=m.length,R=n.current.clientWidth||Math.floor(window.innerWidth*.9),I=w>1?280:330;let d=I;const O=w*I+40;R>O&&(d=Math.floor((R-40)/w));const y=w*d+40;n.current.style.overflowX="auto",n.current.style.webkitOverflowScrolling="touch";const e=document.createElement("div");e.style.width=`${y}px`,e.style.height="150px",e.style.position="relative",n.current.appendChild(e);try{n.current.dataset.musicStaff="true",n.current.id="music-staff-outer"}catch{}const l=document.createElement("canvas");l.width=y,l.height=150,l.style.width=`${y}px`,l.style.height="150px",e.appendChild(l);try{e.dataset.musicStaffInner="true",e.id="music-staff-inner"}catch{}const T=new C(l,C.Backends.CANVAS);T.resize(y,150);const s=T.getContext(),X=new P;let A=10;const W=[],p=[];m.forEach((t,f)=>{p.push(A),t.length>0&&t[t.length-1].originalIndex;const a=new H(A,40,d);f===0&&a.addClef(M).addTimeSignature("4/4"),a.setContext(s).draw();const c=t.map(i=>{const o=new L({keys:[i.note],duration:i.duration||"w",clef:M,auto_stem:!0});if(i.originalIndex===_&&o.setStyle({fillStyle:"#A78BFA",strokeStyle:"#A78BFA"}),u&&typeof u[i.originalIndex]<"u"){const r=u[i.originalIndex];r==="correct"?o.setStyle({fillStyle:"#10B981",strokeStyle:"#10B981"}):r==="wrong"&&o.setStyle({fillStyle:"#F87171",strokeStyle:"#F87171"})}return o}),h=new N({num_beats:4,beat_value:4}).setStrict(!1);h.addTickables(c),X.joinVoices([h]).format([h],d*.8),h.draw(s,a),U.generateBeams(c).forEach(i=>i.setContext(s).draw()),c.forEach((i,o)=>{const r=i.getAbsoluteX(),v=t[o].originalIndex;W[v]=r}),u&&(s.save(),s.font="20px Arial",s.textAlign="center",s.textBaseline="middle",t.forEach((i,o)=>{const r=u[i.originalIndex];if(!r)return;const E=c[o].getAbsoluteX()+6,k=28;r==="correct"?(s.fillStyle="#10B981",s.fillText("✓",E,k)):r==="wrong"&&(s.fillStyle="#EF4444",s.fillText("✕",E,k))}),s.restore()),A+=d}),e._notePositions=W,e._measureStarts=p,e._measureWidth=d;try{e._lastMeasureRef=F}catch{}e._canvas=l,n.current._inner=e;try{window.__musicStaffDebug={inner:e,container:n.current}}catch{}(function(){if(!n.current||!e||!l)return;const f=m.findIndex(v=>v.some(E=>E.originalIndex===_));if(f<0)return;const a=n.current,c=a.clientWidth,h=Math.max(0,e.scrollWidth-c),B=p[f],o=(p[f+1]||y-20)-B;let r=B-c/2+o/2;r=Math.max(0,Math.min(r,h)),Math.abs(a.scrollLeft-r)>10&&a.scrollTo({left:r,behavior:"smooth"})})()}},[M,g,_,u]),$.jsx("div",{ref:n,style:{minHeight:"150px",width:"100%"}})};export{z as default};
